# Amazon Q를 활용한 Redshift 자연어 쿼리 분석 시스템

이 프로젝트는 자연어를 사용하여 Amazon Redshift 데이터를 쿼리하고 분석하는 시스템입니다. LangGraph를 사용하여 워크플로우를 구성하고, Bedrock의 Claude 3.7을 활용하여 자연어 처리를 수행합니다.

## 시스템 구성 요소

### 1. 워크플로우 관리 (LangGraph)
- 자연어 처리 및 SQL 생성 파이프라인 구성
- 오류 처리 및 재시도 로직 구현
- 조건부 워크플로우 분기 처리

### 2. 자연어 처리 (Amazon Bedrock - Claude 3.7)
- 자연어 요청을 SQL로 변환
- 결과 검증 및 인사이트 생성
- 오류 메시지 해석 및 SQL 개선

### 3. 데이터 접근 (Amazon Redshift)
- SQL 실행 및 결과 검색
- 스키마 정보 조회
- SQL 검증 (ANALYZE 활용)

### 4. 사용자 인터페이스 (Streamlit)
- 대화형 채팅 인터페이스
- 결과 시각화 및 표시
- 사용자 피드백 수집

## 주요 기능 상세 설명

### SQL 생성 및 검증
시스템은 사용자의 자연어 요청을 받아 Redshift 스키마 정보를 기반으로 SQL 쿼리를 생성합니다. 생성된 SQL은 Redshift의 ANALYZE 명령을 통해 실행 전에 검증됩니다. 검증에 실패할 경우, 오류 메시지를 분석하여 SQL을 개선합니다.

### 결과 검증 및 인사이트 생성
SQL 실행 결과가 사용자의 원래 요청을 충족하는지 검증합니다. 충족하지 않을 경우, 시스템은 SQL을 재생성합니다. 결과가 적절하다면, 데이터를 분석하여 의미 있는 인사이트를 제공합니다.

### 오류 처리 및 재시도
LangGraph의 조건부 에지를 활용하여 오류 발생 시 적절한 단계로 돌아가 재시도합니다. 이 과정에서 이전 오류 정보를 활용하여 더 나은 결과를 생성합니다.

## 기술적 구현 세부사항

### LangGraph 노드 구성
- `generate_sql`: 자연어 요청을 SQL로 변환
- `validate_sql`: SQL 유효성 검증
- `execute_sql`: SQL 실행 및 결과 반환
- `verify_results`: 결과가 요청을 충족하는지 검증
- `generate_insights`: 데이터 기반 인사이트 생성

### 조건부 에지 설정
- SQL 검증 실패 → SQL 생성 단계로 돌아감 (오류 정보 포함)
- SQL 실행 실패 → SQL 생성 단계로 돌아감 (오류 정보 포함)
- 결과 검증 실패 → SQL 생성 단계로 돌아감 (검증 피드백 포함)

이 시스템을 통해 사용자는 SQL에 대한 전문 지식 없이도 복잡한 데이터 분석을 수행할 수 있습니다.
